<?xml version="1.0" encoding="UTF-8"?>
<!-- SensicsTray.wxs is generated by heat and included in this project. It references
     the SensicsTray.TargetDir variable to find the source files for the SensicsTray application.
     The Setup project specifies it as: SensicsTray.TargetDir=..\electron-app\dist\win-unpacked
     but if building from the command line you'll need to add the appropriate command line options.
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<Product Id="*" 
           Name="SensicsTray" 
           Language="1033" 
           Version="1.0.0.0" 
           Manufacturer="Sensics, Inc." 
           UpgradeCode="e4ddd08b-d18a-46ce-b468-8b7c1972873b">
		<Package InstallerVersion="200"
             Keywords="Installer"
             Description="SensicsTray installer"
             Comments="SensicsTray is a trademark of Sensics, Inc."
             Compressed="yes" 
             InstallScope="perMachine" />
    
    <!-- Sets up this property for the WixUI to allow the user to change the
         install directory. 
         TODO: read/set a registry key for this directory so that upgrade installs
               go to the right place by default.-->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    
    <!-- Sets up a basic installer UI (requires linker option -ext WixUIExtension)-->
    <UIRef Id="WixUI_Mondo" />
    <UIRef Id="WixUI_ErrorProgressText" />
    
    <!--Icon Id="SensicsTray.exe" SourceFile="#fil8F2207F4E3027F053116A9BE61515CEB" /-->
		<MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    
    <!-- Embed the .cab file in the .msi file -->
		<MediaTemplate EmbedCab="yes"/>

    <!-- License File -->
    <WixVariable Id="WixUILicenseRtf" Value="WixUILicenseRtf.rtf" />
    
    <!-- Banner logo on top of all but the first screen (needs to be white background,
         not very busy on the left side so that the user can read the text) -->
    <!--WixVariable Id="WixUIBannerBmp" Value="WixUIBannerBmp.bmp" /-->
    
    <Feature Id="Complete"
             Title="SensicsTray"
             Description="SensicsTray by Sensics, Inc."
             Display="expand"
             ConfigurableDirectory="INSTALLDIR"
             Level="1">
		  <Feature Id="ProductFeature" 
               Title="SensicsTray" 
               Level="1"               
               Description="Install the complete SensicsTray application">
        <!-- SensicsTrayComponents is defined in SensicsTray.wxs and is auto-generated
             by the heat tool -->
			  <ComponentGroupRef Id="SensicsTrayComponents" />
        <ComponentRef Id="ApplicationShortcut" />
		  </Feature>
    </Feature>
	</Product>

	<Fragment>
		<Directory Id="TARGETDIR" Name="SourceDir">
      
      <!-- Start menu shortcut (see below) -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Sensics">
          <Directory Id="SensicsMenuFolder" Name="SensicsTray"></Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramFilesFolder" Name="PFiles">
        <!-- The installer UI lets the user customize this folder, but the default is
             under Program Files/Sensics/SensicsTray-->
        <Directory Id="INSTALLDIR" Name="Sensics">
          <!--SensicsTrayDir is referenced by the generated SensicsTray.wxs, which uses 
              the heat tool to auto-generate the file list to be installed. This definition
              here places the output of those files.-->
          <Directory Id="SensicsTrayDir" Name="SensicsTray" />
        </Directory>
      </Directory>
		</Directory>

    <!-- Start Menu shortcut (references directory defined above)-->
    <DirectoryRef Id="SensicsMenuFolder">
      <Component Id="ApplicationShortcut"
                 Guid="5E566764-0B46-4E60-B5C5-2504869AA4A9">
        <Shortcut Id="ApplicationStartMenuShortcut"
                  Name="SensicsTray"
                  Description="SensicsTray application."
                  Target="[#fil8F2207F4E3027F053116A9BE61515CEB]"
                  WorkingDirectory="SensicsTrayDir" />
        <RegistryValue Root="HKCU" Key="Software\Microsoft\SensicsTray" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
        <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall" />
        <RemoveFolder Id="CleanUpShortCut2" Directory="SensicsMenuFolder" On="uninstall" />
      </Component>
    </DirectoryRef>
	</Fragment>
</Wix>
